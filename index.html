<!DOCTYPE html>
<html>
<head>
    <title>Subject Report Generator</title>
    <script>
        const AUTHORIZED_USERS = [
            'username1', 
            'username2', 
            'username3'
        ];

        function checkAuth() {
            // GitHub Pages provides this via _username cookie
            const username = document.cookie.replace(/(?:(?:^|.*;\s*)_username\s*\=\s*([^;]*).*$)|^.*$/, "$1");
            
            if (!AUTHORIZED_USERS.includes(username)) {
                alert('Unauthorized access');
                window.location.href = '/login.html';
                return false;
            }
            return true;
        }

        function submitForm() {
            if (!checkAuth()) return;

            const subjectid = document.getElementById('subjectid').value;
            const username = document.cookie.replace(/(?:(?:^|.*;\s*)_username\s*\=\s*([^;]*).*$)|^.*$/, "$1");

            fetch('https://api.github.com/repos/SOM-DOP-MINDCraft/mindlamp/dispatches', {
                method: 'POST',
                headers: {
                    'Authorization': `token ${{ secrets.GITHUB_TOKEN }}`,
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    'event_type': 'generate_report',
                    'client_payload': {
                        'subjectid': subjectid,
                        'username': username
                    }
                })
            });
        }
    </script>
</head>
<body onload="checkAuth()">
    <input type="text" id="subjectid" placeholder="Enter Subject ID">
    <button onclick="submitForm()">Generate Report</button>
</body>
</html>
