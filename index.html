<!DOCTYPE html>
<html>
<head>
    <title>Subject Report Generator</title>
    <script>
        function checkAuth() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            
            if (!token) {
                window.location.href = '/login';
                return;
            }
            
            // Store token securely
            sessionStorage.setItem('githubToken', token);
        }
        
        function submitForm() {
            const token = sessionStorage.getItem('githubToken');
            const subjectid = document.getElementById('subjectid').value;
            
            fetch('https://api.github.com/repos/OWNER/REPO/dispatches', {
                method: 'POST',
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    'event_type': 'generate_report',
                    'client_payload': {
                        'subjectid': subjectid,
                        'username': 'current_user'
                    }
                })
            });
        }
        
        window.onload = checkAuth;
    </script>
</head>
<body>
    <input type="text" id="subjectid" placeholder="Enter Subject ID">
    <button onclick="submitForm()">Generate Report</button>
</body>
</html>
